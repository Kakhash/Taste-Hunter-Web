(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[426],{6489:function(e,t){"use strict";t.parse=function(e,t){if("string"!=typeof e)throw TypeError("argument str must be a string");for(var o={},i=e.split(";"),n=(t||{}).decode||r,s=0;s<i.length;s++){var a=i[s],c=a.indexOf("=");if(!(c<0)){var d=a.substring(0,c).trim();if(void 0==o[d]){var u=a.substring(c+1,a.length).trim();'"'===u[0]&&(u=u.slice(1,-1)),o[d]=function(e,t){try{return t(e)}catch(t){return e}}(u,n)}}}return o},t.serialize=function(e,t,r){var n=r||{},s=n.encode||o;if("function"!=typeof s)throw TypeError("option encode is invalid");if(!i.test(e))throw TypeError("argument name is invalid");var a=s(t);if(a&&!i.test(a))throw TypeError("argument val is invalid");var c=e+"="+a;if(null!=n.maxAge){var d=n.maxAge-0;if(isNaN(d)||!isFinite(d))throw TypeError("option maxAge is invalid");c+="; Max-Age="+Math.floor(d)}if(n.domain){if(!i.test(n.domain))throw TypeError("option domain is invalid");c+="; Domain="+n.domain}if(n.path){if(!i.test(n.path))throw TypeError("option path is invalid");c+="; Path="+n.path}if(n.expires){if("function"!=typeof n.expires.toUTCString)throw TypeError("option expires is invalid");c+="; Expires="+n.expires.toUTCString()}if(n.httpOnly&&(c+="; HttpOnly"),n.secure&&(c+="; Secure"),n.sameSite)switch("string"==typeof n.sameSite?n.sameSite.toLowerCase():n.sameSite){case!0:case"strict":c+="; SameSite=Strict";break;case"lax":c+="; SameSite=Lax";break;case"none":c+="; SameSite=None";break;default:throw TypeError("option sameSite is invalid")}return c};var r=decodeURIComponent,o=encodeURIComponent,i=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/},2479:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/orders",function(){return r(1511)}])},1511:function(e,t,r){"use strict";r.r(t),r.d(t,{__N_SSP:function(){return c},default:function(){return d}});var o=r(5893),i=r(7294),n=r(4105),s=r(2286),a=r(1163),c=!0;function d(e){let{initialOrders:t}=e,[r,c]=(0,i.useState)(t),d=(0,i.useRef)(null),u=(0,a.useRouter)();return(0,i.useEffect)(()=>{let e=setInterval(async()=>{let e=await fetch("/api/admin/orders");if(e.ok){let t=await e.json();c(t.orders),t.orders.some(e=>"unpaid"===e.status&&!e.received)&&d.current&&d.current.play().catch(()=>{})}},5e3);return()=>clearInterval(e)},[]),(0,o.jsxs)("div",{style:{padding:20},children:[(0,o.jsx)("audio",{ref:d,children:(0,o.jsx)("source",{src:"/sounds/ding.mp3",type:"audio/mpeg"})}),(0,o.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,o.jsx)("h1",{children:"\uD83E\uDDFE Orders"}),(0,o.jsx)("button",{onClick:()=>{(0,s.destroyCookie)(null,"admin_auth",{path:"/"}),u.push("/admin/login")},style:{backgroundColor:"#f87171",color:"white",padding:"8px 12px",border:"none",borderRadius:4},children:"Logout"})]}),(0,o.jsx)("button",{onClick:()=>{let e=r.map(e=>({ID:e.id,Status:e.status,Total:e.total,Items:e.items.map(e=>"".concat(e.name," \xd7 ").concat(e.qty)).join(", "),Created:new Date(e.createdAt).toLocaleString()})),t=n.P6.json_to_sheet(e),o=n.P6.book_new();n.P6.book_append_sheet(o,t,"Orders");let i=new Blob([n.cW(o,{bookType:"xlsx",type:"array"})],{type:"application/octet-stream"}),s=URL.createObjectURL(i),a=document.createElement("a");a.href=s,a.download="orders_".concat(new Date().toISOString(),".xlsx"),a.click(),URL.revokeObjectURL(s)},style:{marginBottom:20,padding:"10px 20px",backgroundColor:"#0070f3",color:"white",border:"none",borderRadius:4},children:"Export to Excel"}),(0,o.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{children:"ID"}),(0,o.jsx)("th",{children:"Status"}),(0,o.jsx)("th",{children:"Total"}),(0,o.jsx)("th",{children:"Items"}),(0,o.jsx)("th",{children:"Created"}),(0,o.jsx)("th",{children:"Action"})]})}),(0,o.jsx)("tbody",{children:r.map(e=>(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:e.id}),(0,o.jsx)("td",{children:e.status}),(0,o.jsxs)("td",{children:[e.total," GEL"]}),(0,o.jsx)("td",{children:e.items.map((e,t)=>(0,o.jsxs)("div",{children:[e.name," \xd7 ",e.qty]},t))}),(0,o.jsx)("td",{children:new Date(e.createdAt).toLocaleString()}),(0,o.jsx)("td",{children:"unpaid"===e.status&&!e.received&&(0,o.jsx)("button",{onClick:async()=>{await fetch("/api/admin/orders/".concat(e.id,"/receive"),{method:"POST"});let t=await fetch("/api/admin/orders");c((await t.json()).orders)},style:{backgroundColor:"#10b981",color:"white",padding:"5px 10px",border:"none",borderRadius:4},children:"Mark Received"})})]},e.id))})]})]})}},1163:function(e,t,r){e.exports=r(3079)},2286:function(e,t,r){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.destroyCookie=t.setCookie=t.parseCookies=void 0;var i=r(6489),n=r(9328),s=r(1022);function a(e,t){var r,o;return(null===(o=null===(r=null==e?void 0:e.req)||void 0===r?void 0:r.headers)||void 0===o?void 0:o.cookie)?i.parse(e.req.headers.cookie,t):s.isBrowser()?i.parse(document.cookie,t):{}}function c(e,t,r,a){var c,d;if(void 0===a&&(a={}),(null===(c=null==e?void 0:e.res)||void 0===c?void 0:c.getHeader)&&e.res.setHeader){if(null===(d=null==e?void 0:e.res)||void 0===d?void 0:d.finished)return console.warn('Not setting "'+t+'" cookie. Response has finished.'),console.warn("You should set cookie before res.send()"),{};var u=e.res.getHeader("Set-Cookie")||[];"string"==typeof u&&(u=[u]),"number"==typeof u&&(u=[]);var l=n.parse(u,{decodeValues:!1}),p=s.createCookie(t,r,a),h=[];l.forEach(function(e){if(!s.areCookiesEqual(e,p)){var t=i.serialize(e.name,e.value,o({encode:function(e){return e}},e));h.push(t)}}),h.push(i.serialize(t,r,a)),e.res.setHeader("Set-Cookie",h)}if(s.isBrowser()){if(a&&a.httpOnly)throw Error("Can not set a httpOnly cookie in the browser.");document.cookie=i.serialize(t,r,a)}return{}}function d(e,t,r){return c(e,t,"",o(o({},r||{}),{maxAge:-1}))}t.parseCookies=a,t.setCookie=c,t.destroyCookie=d,t.default={set:c,get:a,destroy:d}},1022:function(e,t){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function o(e,t){var r=Object.getOwnPropertyNames(e),o=Object.getOwnPropertyNames(t);if(r.length!==o.length)return!1;for(var i=0;i<r.length;i++){var n=r[i];if(e[n]!==t[n])return!1}return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.areCookiesEqual=t.hasSameProperties=t.createCookie=t.isBrowser=void 0,t.isBrowser=function(){return"undefined"!=typeof window},t.createCookie=function(e,t,o){var i=o.sameSite;!0===i&&(i="strict"),(void 0===i||!1===i)&&(i="lax");var n=r(r({},o),{sameSite:i});return delete n.encode,r({name:e,value:t},n)},t.hasSameProperties=o,t.areCookiesEqual=function(e,t){var i=e.sameSite===t.sameSite;return"string"==typeof e.sameSite&&"string"==typeof t.sameSite&&(i=e.sameSite.toLowerCase()===t.sameSite.toLowerCase()),o(r(r({},e),{sameSite:void 0}),r(r({},t),{sameSite:void 0}))&&i}},9328:function(e){"use strict";var t={decodeValues:!0,map:!1,silent:!1};function r(e){return"string"==typeof e&&!!e.trim()}function o(e,o){var i,n,s,a,c=e.split(";").filter(r),d=(i=c.shift(),n="",s="",(a=i.split("=")).length>1?(n=a.shift(),s=a.join("=")):s=i,{name:n,value:s}),u=d.name,l=d.value;o=o?Object.assign({},t,o):t;try{l=o.decodeValues?decodeURIComponent(l):l}catch(e){console.error("set-cookie-parser encountered an error while decoding a cookie with value '"+l+"'. Set options.decodeValues to false to disable this feature.",e)}var p={name:u,value:l};return c.forEach(function(e){var t=e.split("="),r=t.shift().trimLeft().toLowerCase(),o=t.join("=");"expires"===r?p.expires=new Date(o):"max-age"===r?p.maxAge=parseInt(o,10):"secure"===r?p.secure=!0:"httponly"===r?p.httpOnly=!0:"samesite"===r?p.sameSite=o:"partitioned"===r?p.partitioned=!0:p[r]=o}),p}function i(e,i){if(i=i?Object.assign({},t,i):t,!e)return i.map?{}:[];if(e.headers){if("function"==typeof e.headers.getSetCookie)e=e.headers.getSetCookie();else if(e.headers["set-cookie"])e=e.headers["set-cookie"];else{var n=e.headers[Object.keys(e.headers).find(function(e){return"set-cookie"===e.toLowerCase()})];n||!e.headers.cookie||i.silent||console.warn("Warning: set-cookie-parser appears to have been called on a request object. It is designed to parse Set-Cookie headers from responses, not Cookie headers from requests. Set the option {silent: true} to suppress this warning."),e=n}}return(Array.isArray(e)||(e=[e]),i.map)?e.filter(r).reduce(function(e,t){var r=o(t,i);return e[r.name]=r,e},{}):e.filter(r).map(function(e){return o(e,i)})}e.exports=i,e.exports.parse=i,e.exports.parseString=o,e.exports.splitCookiesString=function(e){if(Array.isArray(e))return e;if("string"!=typeof e)return[];var t,r,o,i,n,s=[],a=0;function c(){for(;a<e.length&&/\s/.test(e.charAt(a));)a+=1;return a<e.length}for(;a<e.length;){for(t=a,n=!1;c();)if(","===(r=e.charAt(a))){for(o=a,a+=1,c(),i=a;a<e.length&&"="!==(r=e.charAt(a))&&";"!==r&&","!==r;)a+=1;a<e.length&&"="===e.charAt(a)?(n=!0,a=i,s.push(e.substring(t,o)),t=a):a=o+1}else a+=1;(!n||a>=e.length)&&s.push(e.substring(t,e.length))}return s}},67:function(){},2061:function(){}},function(e){e.O(0,[251,888,774,179],function(){return e(e.s=2479)}),_N_E=e.O()}]);